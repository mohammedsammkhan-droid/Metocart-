<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metocart | Hybrid Solutions Pvt Ltd</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --dark-bg: #0f172a; --card-bg: #1e293b; --text-main: #f8fafc; --accent: #10b981; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--dark-bg); color: var(--text-main); }
        #loginScreen { height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at top right, #1b1b4b, #0f172a); }
        .login-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); padding: 40px; border-radius: 24px; width: 340px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .sidebar { width: 260px; background: #020617; position: fixed; height: 100%; padding: 24px; border-right: 1px solid #1e293b; }
        .nav-btn { width: 100%; padding: 14px; margin: 8px 0; background: transparent; color: #94a3b8; border: none; border-radius: 12px; text-align: left; cursor: pointer; transition: 0.2s; font-weight: 600; }
        .nav-btn.active { background: var(--primary); color: white; }
        .main-content { margin-left: 280px; padding: 40px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card-bg); padding: 24px; border-radius: 20px; border: 1px solid #334155; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid #334155; margin-bottom: 20px; }
        input, select { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; color: white; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button.action-btn { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; width: 100%; transition: 0.3s; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #94a3b8; padding: 12px; border-bottom: 1px solid #334155; }
        td { padding: 12px; border-bottom: 1px solid #1e293b; }
        .section { display: none; }
        .active-section { display: block; }
        .cart-item { background: #0f172a; padding: 12px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #1e293b; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-card">
        <h1 style="color:var(--primary)">Metocart</h1>
        <p style="color:#94a3b8; margin-top:-10px; font-size:0.8em;">Hybrid Solutions Pvt Ltd</p>
        <input type="text" id="username" placeholder="Username" value="admin">
        <input type="password" id="password" placeholder="Password" value="1234">
        <button class="action-btn" onclick="login()">Sign In</button>
    </div>
</div>

<div class="dashboard-container" id="dashboard" style="display:none">
    <div class="sidebar">
        <h2 style="color:var(--primary); margin-bottom: 5px;">Metocart</h2>
        <p style="color:#64748b; font-size: 0.7em; margin-bottom: 30px;">Hybrid Solutions Pvt Ltd</p>
        <button class="nav-btn active" onclick="showTab('home')">üè† Dashboard</button>
        <button class="nav-btn" onclick="showTab('billing')">üßæ Fast Billing</button>
        <button class="nav-btn" onclick="showTab('inventory')">üì¶ Inventory</button>
        <button class="nav-btn" onclick="showTab('customers')">üë• Customers</button>
        <button class="nav-btn" onclick="showTab('ai')">ü§ñ AI Advisor</button>
        <button class="nav-btn" style="margin-top: 50px; color:#ef4444" onclick="resetApp()">üóëÔ∏è Reset Data</button>
    </div>

    <div class="main-content">
        <div id="home" class="section active-section">
            <h1>Business Overview</h1>
            <div class="kpi-grid">
                <div class="kpi-card"><p>Total Sales</p><h2 id="rev">‚Çπ0</h2></div>
                <div class="kpi-card"><p>Net Profit</p><h2 id="profit">‚Çπ0</h2></div>
                <div class="kpi-card"><p>GST (18%)</p><h2 id="gstTotal">‚Çπ0</h2></div>
            </div>
        </div>

        <div id="billing" class="section">
            <div class="card">
                <h2>New Transaction</h2>
                <div style="display:grid; grid-template-columns: 2fr 1fr; gap:10px; margin-bottom: 15px;">
                    <input id="billCustName" list="customerList" placeholder="Enter Customer Name">
                    <datalist id="customerList"></datalist>
                    <input id="billCustPhone" placeholder="Phone Number (Optional)">
                </div>
                <hr style="border:0; border-top:1px solid #334155; margin:20px 0;">
                <div style="display:grid; grid-template-columns: 2fr 1fr 100px; gap:10px;">
                    <select id="billProduct"><option value="">Select Item</option></select>
                    <input type="number" id="billQty" value="1" placeholder="Qty">
                    <button class="action-btn" onclick="addToCart()" style="background:var(--accent)">Add</button>
                </div>

                <div id="cartDisplay" style="margin-top:20px;">
                    <div id="cartItemsList"></div>
                    <div id="cartSummary" style="display:none; text-align:right; margin-top:20px; border-top:1px solid #334155; padding-top:15px;">
                        <h3 id="cartTotalText" style="color:var(--accent)">Total: ‚Çπ0</h3>
                        <button class="action-btn" style="width:220px" onclick="fastCheckout()">Generate & Print Bill</button>
                    </div>
                </div>
                <div id="invoiceOutput" style="margin-top:20px;"></div>
            </div>
        </div>

        <div id="inventory" class="section">
            <div class="card">
                <h2>Product Management</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input id="pname" placeholder="Product Name">
                    <input id="pcategory" placeholder="HSN Code">
                    <input type="number" id="pcost" placeholder="Cost Price">
                    <input type="number" id="psell" placeholder="Sale Price">
                    <input type="number" id="pqty" placeholder="Initial Stock">
                </div>
                <button class="action-btn" style="margin-top:15px;" onclick="addProduct()">Save to Inventory</button>
                <table>
                    <thead><tr><th>Product</th><th>HSN</th><th>Stock</th></tr></thead>
                    <tbody id="inventoryBody"></tbody>
                </table>
            </div>
        </div>

        <div id="customers" class="section">
            <div class="card">
                <h2>Customer Registry</h2>
                <table>
                    <thead><tr><th>Name</th><th>Phone</th></tr></thead>
                    <tbody id="customerBody"></tbody>
                </table>
            </div>
        </div>

        <div id="ai" class="section">
            <div class="card">
                <h2>AI Growth Advisor</h2>
                <input id="aiQuestion" placeholder="How can I improve my profit margins?">
                <button class="action-btn" style="width:150px; margin-top:10px;" onclick="generateAI()">Ask AI</button>
                <div id="aiOutput" style="margin-top:20px; padding:15px; background:#0f172a; border-radius:10px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // CORE DATA & STORAGE
    let products = JSON.parse(localStorage.getItem('hy_products')) || [];
    let customers = JSON.parse(localStorage.getItem('hy_customers')) || [];
    let totals = JSON.parse(localStorage.getItem('hy_totals')) || { rev: 0, profit: 0, gst: 0 };
    let currentCart = [];

    const GROQ_API_KEY = "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";

    window.onload = () => {
        renderInventory();
        renderCustomers();
        updateLists();
        updateStats();
    };

    function saveData() {
        localStorage.setItem('hy_products', JSON.stringify(products));
        localStorage.setItem('hy_customers', JSON.stringify(customers));
        localStorage.setItem('hy_totals', JSON.stringify(totals));
    }

    function resetApp() {
        if(confirm("Delete all store data?")) { localStorage.clear(); location.reload(); }
    }

    function login() {
        if(document.getElementById('username').value === "admin" && document.getElementById('password').value === "1234") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        } else { alert("Access Denied"); }
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-section');
        event.currentTarget.classList.add('active');
    }

    // INVENTORY LOGIC
    function addProduct() {
        const p = { 
            name: pname.value, hsn: pcategory.value, 
            cost: parseFloat(pcost.value), sell: parseFloat(psell.value), qty: parseInt(pqty.value) 
        };
        products.push(p);
        saveData();
        renderInventory();
        updateLists();
        pname.value = ''; pcost.value = ''; psell.value = ''; pqty.value = '';
    }

    function renderInventory() {
        inventoryBody.innerHTML = products.map(p => `<tr><td>${p.name}</td><td>${p.hsn}</td><td>${p.qty}</td></tr>`).join('');
    }

    function renderCustomers() {
        customerBody.innerHTML = customers.map(c => `<tr><td>${c.name}</td><td>${c.phone}</td></tr>`).join('');
    }

    function updateLists() {
        billProduct.innerHTML = '<option value="">Select Item</option>' + products.map((p, i) => `<option value="${i}">${p.name} (Stock: ${p.qty})</option>`).join('');
        const list = document.getElementById('customerList');
        list.innerHTML = customers.map(c => `<option value="${c.name}">`).join('');
    }

    function updateStats() {
        rev.innerText = "‚Çπ" + totals.rev.toFixed(0);
        profit.innerText = "‚Çπ" + totals.profit.toFixed(0);
        gstTotal.innerText = "‚Çπ" + totals.gst.toFixed(0);
    }

    // FAST BILLING LOGIC
    function addToCart() {
        const pIdx = billProduct.value;
        const qty = parseInt(billQty.value);
        if(pIdx === "" || qty <= 0) return alert("Select product and quantity");

        const p = products[pIdx];
        if(qty > p.qty) return alert("Insufficient stock!");

        currentCart.push({ 
            id: pIdx, name: p.name, qty: qty, price: p.sell, cost: p.cost, subtotal: p.sell * qty 
        });
        renderCart();
    }

    function renderCart() {
        const list = document.getElementById('cartItemsList');
        const summary = document.getElementById('cartSummary');
        let total = 0;

        list.innerHTML = currentCart.map((item, i) => {
            total += item.subtotal;
            return `<div class="cart-item">
                <span><b>${item.name}</b> (x${item.qty})</span>
                <span>‚Çπ${item.subtotal.toFixed(2)} <button onclick="currentCart.splice(${i},1);renderCart();" style="color:red; background:none; border:none; cursor:pointer; margin-left:10px;">‚úñ</button></span>
            </div>`;
        }).join('');

        summary.style.display = currentCart.length > 0 ? 'block' : 'none';
        document.getElementById('cartTotalText').innerText = `Total: ‚Çπ${(total * 1.18).toFixed(2)}`;
    }

    function fastCheckout() {
        const name = document.getElementById('billCustName').value;
        const phone = document.getElementById('billCustPhone').value || "N/A";

        if(!name) return alert("Enter customer name");
        if(currentCart.length === 0) return alert("Cart is empty");

        // Hybrid Solution: Auto-register if new name
        let existingCust = customers.find(c => c.name.toLowerCase() === name.toLowerCase());
        if(!existingCust) {
            customers.push({ name: name, phone: phone });
            saveData();
            renderCustomers();
            updateLists();
        }

        let bTotal = 0; let bProfit = 0; let bGst = 0;

        currentCart.forEach(item => {
            const p = products[item.id];
            const itemGst = item.subtotal * 0.18;
            p.qty -= item.qty;
            bTotal += (item.subtotal + itemGst);
            bGst += itemGst;
            bProfit += (item.price - item.cost) * item.qty;
        });

        totals.rev += bTotal; totals.gst += bGst; totals.profit += bProfit;

        saveData();
        updateStats();
        renderInventory();

        printInvoice({name: name, phone: phone}, currentCart, bGst, bTotal);
        
        currentCart = [];
        renderCart();
        document.getElementById('billCustName').value = "";
        document.getElementById('billCustPhone').value = "";
        invoiceOutput.innerHTML = `<div style="background:rgba(16,185,129,0.1); border:1px solid var(--accent); padding:15px; border-radius:10px; color:var(--accent);">‚úÖ Bill successfully generated for ${name}</div>`;
    }

    function printInvoice(cust, cart, gst, grandTotal) {
        const win = window.open('', '_blank', 'width=450,height=600');
        const items = cart.map(i => `<div style="display:flex; justify-content:space-between"><span>${i.name} x${i.qty}</span><span>${i.subtotal.toFixed(2)}</span></div>`).join('');
        
        win.document.write(`
            <body style="font-family:monospace; padding:30px;" onload="window.print(); window.close();">
                <center>
                    <h2 style="margin-bottom:0">HYBRID SOLUTIONS PVT LTD</h2>
                    <p style="margin-top:0">GST INVOICE - METOCART</p>
                </center>
                <hr>
                <p>Date: ${new Date().toLocaleDateString()}<br>Bill To: ${cust.name}<br>Phone: ${cust.phone}</p>
                <hr>
                ${items}
                <hr>
                <div style="display:flex; justify-content:space-between"><span>Subtotal</span><span>‚Çπ${(grandTotal - gst).toFixed(2)}</span></div>
                <div style="display:flex; justify-content:space-between"><span>GST (18%)</span><span>‚Çπ${gst.toFixed(2)}</span></div>
                <div style="display:flex; justify-content:space-between; font-size:1.2em; font-weight:bold; margin-top:10px;"><span>GRAND TOTAL</span><span>‚Çπ${grandTotal.toFixed(2)}</span></div>
                <hr>
                <center><p>Powered by Metocart AI</p></center>
            </body>
        `);
        win.document.close();
    }

    async function generateAI() {
        const out = document.getElementById('aiOutput');
        out.innerHTML = "‚ú® Processing insights...";
        try {
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${GROQ_API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: `Help: ${aiQuestion.value}. Store Stats: Rev ‚Çπ${totals.rev}, Profit ‚Çπ${totals.profit}. List: ${JSON.stringify(products)}` }]
                })
            });
            const data = await res.json();
            out.innerText = data.choices[0].message.content;
        } catch (e) { out.innerText = "Connection error."; }
    }
</script>
</body>
</html>
