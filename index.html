<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetoCart AI | Enterprise OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #6366f1; --primary-glow: rgba(99, 102, 241, 0.4);
            --dark-bg: #050810; --card-bg: rgba(22, 28, 45, 0.7); 
            --text: #f1f5f9; --text-dim: #94a3b8;
            --accent: #10b981; --border: rgba(255, 255, 255, 0.1); --danger: #f43f5e;
        }
        
        * { box-sizing: border-box; transition: all 0.2s ease; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--dark-bg); color: var(--text); overflow-x: hidden; }

        /* LOGO SVG STYLE */
        .logo-svg { width: 35px; height: 35px; filter: drop-shadow(0 0 8px var(--primary)); vertical-align: middle; }

        /* SIDEBAR */
        .sidebar { 
            width: 260px; position: fixed; height: 100vh; padding: 30px 20px; 
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(20px);
            border-right: 1px solid var(--border); z-index: 100; 
        }
        .nav-btn { 
            width: 100%; padding: 14px 18px; margin: 8px 0; background: transparent; 
            color: var(--text-dim); border: none; border-radius: 16px; 
            text-align: left; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 12px; 
        }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 8px 20px var(--primary-glow); }
        
        /* MAIN AREA */
        .main-content { margin-left: 260px; padding: 40px; display: none; }
        .glass-card { background: var(--card-bg); padding: 30px; border-radius: 28px; border: 1px solid var(--border); margin-bottom: 25px; backdrop-filter: blur(15px); }
        
        /* KPI & INPUTS */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card-bg); padding: 25px; border-radius: 24px; border: 1px solid var(--border); }
        input, select { background: rgba(0,0,0,0.5); border: 1px solid var(--border); border-radius: 14px; padding: 15px; color: white; width: 100%; }
        .action-btn { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 14px; cursor: pointer; font-weight: 700; width: 100%; }

        /* INVOICE MODAL */
        #invoiceModal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; 
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .invoice-paper { 
            background: white; color: #000; width: 100%; max-width: 500px; 
            padding: 40px; border-radius: 4px; font-family: 'Courier New', Courier, monospace;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        
        /* PRINT STYLES */
        @media print {
            body * { visibility: hidden; }
            #invoiceModal, #invoiceModal * { visibility: visible; }
            #invoiceModal { position: absolute; left: 0; top: 0; background: white; }
            .no-print { display: none; }
        }

        @media (max-width: 900px) { .sidebar { width: 80px; } .sidebar span, .logo-text { display: none; } .main-content { margin-left: 80px; } }
    </style>
</head>
<body>

<div id="loginOverlay" style="position:fixed; inset:0; background:var(--dark-bg); z-index:3000; display:flex; align-items:center; justify-content:center;">
    <div class="glass-card" style="text-align:center; width:350px;">
        <h1 style="margin:0">MetoCart <span style="color:var(--primary)">AI</span></h1>
        <input type="password" id="passInput" placeholder="Security Key (1234)" style="margin:20px 0">
        <button class="action-btn" onclick="handleLogin()">Login</button>
    </div>
</div>

<aside class="sidebar" id="appSidebar" style="display:none">
    <div style="padding: 10px; margin-bottom:40px;">
        <svg class="logo-svg" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2">
            <circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        <span class="logo-text" style="font-weight:800; font-size:1.2rem; margin-left:10px;">MetoCart <span style="color:var(--primary)">AI</span></span>
    </div>
    <button class="nav-btn active" onclick="showTab('home')">ðŸ“Š <span>Dashboard</span></button>
    <button class="nav-btn" onclick="showTab('billing')">âš¡ <span>Billing</span></button>
    <button class="nav-btn" onclick="showTab('inventory')">ðŸ“¦ <span>Stock</span></button>
    <button class="nav-btn" onclick="location.reload()" style="margin-top:40px; color:var(--danger)">ðŸ”’ <span>Logout</span></button>
</aside>

<main class="main-content" id="appMain">
    <div id="home" class="section active-section">
        <div class="kpi-grid">
            <div class="kpi-card"><small>REVENUE</small><h2 id="revDash">â‚¹0</h2></div>
            <div class="kpi-card"><small>NET PROFIT</small><h2 id="profitDash" style="color:var(--accent)">â‚¹0</h2></div>
            <div class="kpi-card"><small>STOCK VALUE</small><h2 id="invValDash">â‚¹0</h2></div>
        </div>
        <div class="glass-card">
            <h3>ðŸ“ˆ Sales Performance</h3>
            <canvas id="salesChart" style="max-height: 250px;"></canvas>
        </div>
    </div>

    <div id="billing" class="section">
        <div class="glass-card">
            <h2>Fast Terminal</h2>
            <div style="display:grid; grid-template-columns: 2fr 1fr 100px; gap:12px;">
                <select id="billProdSelect"></select>
                <input type="number" id="billQty" value="1" min="1">
                <button class="action-btn" onclick="addToCart()">Add</button>
            </div>
            <table style="width:100%; margin-top:30px; border-collapse: collapse;">
                <tbody id="cartItems"></tbody>
            </table>
            <div style="text-align:right; margin-top:40px; border-top:1px solid var(--border); padding-top:20px;">
                <h1 id="billTotal" style="font-size:3.5rem; margin:0;">â‚¹0</h1>
                <button class="action-btn" style="background:var(--accent); width:280px; margin-top:20px;" onclick="completeSale()">Finalize & Print</button>
            </div>
        </div>
    </div>

    <div id="inventory" class="section">
        <div class="glass-card">
            <h2>Inventory Entry</h2>
            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:12px;">
                <input id="p_name" placeholder="Item Name">
                <input id="p_cost" type="number" placeholder="Cost Price">
                <input id="p_sell" type="number" placeholder="Sale Price">
                <input id="p_qty" type="number" placeholder="Qty">
            </div>
            <button class="action-btn" style="margin-top:15px;" onclick="saveInventory()">Save Stock</button>
        </div>
        <div class="glass-card">
            <table style="width:100%; text-align:left;">
                <thead style="color:var(--text-dim)"><tr><th>PRODUCT</th><th>STOCK</th><th>MARGIN</th></tr></thead>
                <tbody id="masterInvList"></tbody>
            </table>
        </div>
    </div>
</main>

<div id="invoiceModal">
    <div class="invoice-paper" id="invoicePaper">
        </div>
</div>

<script>
    const INV_KEY = "metocart_v5_inv";
    const SALES_KEY = "metocart_v5_sales";
    let products = JSON.parse(localStorage.getItem(INV_KEY)) || [];
    let sales = JSON.parse(localStorage.getItem(SALES_KEY)) || [];
    let cart = [];
    let myChart;

    function handleLogin() {
        if(document.getElementById('passInput').value === "1234") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('appSidebar').style.display = 'block';
            document.getElementById('appMain').style.display = 'block';
            updateDash();
        } else { alert("Wrong Code"); }
    }

    function updateChart() {
        const ctx = document.getElementById('salesChart').getContext('2d');
        const last7 = sales.slice(-7).map(s => s.total);
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: { labels: last7.map((_,i)=>i+1), datasets: [{ data: last7, borderColor: '#6366f1', tension: 0.4, fill: true, backgroundColor: 'rgba(99,102,241,0.1)' }] },
            options: { plugins: { legend: { display: false } }, scales: { x: { display: false } } }
        });
    }

    function updateDash() {
        let rev = 0, prof = 0, invVal = 0;
        sales.forEach(s => { rev += s.total; prof += s.profit; });
        products.forEach(p => { invVal += (p.cost * p.qty); });
        document.getElementById('revDash').innerText = "â‚¹" + rev.toLocaleString();
        document.getElementById('profitDash').innerText = "â‚¹" + prof.toLocaleString();
        document.getElementById('invValDash').innerText = "â‚¹" + invVal.toLocaleString();
        updateChart();
    }

    function saveInventory() {
        const n = document.getElementById('p_name').value, c = parseFloat(document.getElementById('p_cost').value), s = parseFloat(document.getElementById('p_sell').value), q = parseInt(document.getElementById('p_qty').value);
        products.push({ name: n, cost: c, sell: s, qty: q });
        localStorage.setItem(INV_KEY, JSON.stringify(products));
        renderInvTable(); updateDash();
    }

    function renderInvTable() {
        document.getElementById('masterInvList').innerHTML = products.map(p => `<tr><td>${p.name}</td><td>${p.qty}</td><td>${(((p.sell-p.cost)/p.cost)*100).toFixed(0)}%</td></tr>`).join('');
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');
        if(id === 'inventory') renderInvTable();
        if(id === 'billing') refreshBillSelect();
    }

    function refreshBillSelect() {
        document.getElementById('billProdSelect').innerHTML = products.map((p, i) => `<option value="${i}">${p.name} (Stock: ${p.qty})</option>`).join('');
    }

    function addToCart() {
        const idx = document.getElementById('billProdSelect').value, q = parseInt(document.getElementById('billQty').value), p = products[idx];
        if(q > p.qty) return alert("No Stock");
        cart.push({ name: p.name, qty: q, price: p.sell, cost: p.cost, sub: p.sell * q, id: idx });
        renderCart();
    }

    function renderCart() {
        let total = cart.reduce((a, b) => a + b.sub, 0);
        document.getElementById('cartItems').innerHTML = cart.map(c => `<tr><td>${c.name} x ${c.qty}</td><td style="text-align:right">â‚¹${c.sub}</td></tr>`).join('');
        document.getElementById('billTotal').innerText = "â‚¹" + (total * 1.18).toFixed(0);
    }

    function completeSale() {
        if(!cart.length) return;
        const total = parseFloat(document.getElementById('billTotal').innerText.replace('â‚¹',''));
        const subTotal = cart.reduce((a, b) => a + b.sub, 0);
        const tax = total - subTotal;
        const profit = cart.reduce((a, b) => a + ((b.price - b.cost) * b.qty), 0);

        // Update Stock
        cart.forEach(c => { products[c.id].qty -= c.qty; });
        sales.push({ total, profit });
        localStorage.setItem(INV_KEY, JSON.stringify(products));
        localStorage.setItem(SALES_KEY, JSON.stringify(sales));

        generateInvoice(subTotal, tax, total);
        cart = []; renderCart(); updateDash();
    }

    function generateInvoice(sub, tax, total) {
        const date = new Date().toLocaleString();
        const invId = "INV-" + Math.floor(Math.random()*100000);
        let itemsHtml = cart.map(c => `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>${c.name} x${c.qty}</span>
                <span>â‚¹${c.sub}</span>
            </div>`).join('');

        document.getElementById('invoicePaper').innerHTML = `
            <div style="text-align:center; margin-bottom:20px;">
                <h2 style="margin:0">METOCART AI</h2>
                <small>Intelligent Retail Solutions</small>
            </div>
            <div style="border-bottom: 1px dashed #000; padding-bottom:10px; margin-bottom:10px;">
                <div>ID: ${invId}</div>
                <div>DATE: ${date}</div>
            </div>
            <div style="margin-bottom:20px;">${itemsHtml}</div>
            <div style="border-top: 1px dashed #000; padding-top:10px;">
                <div style="display:flex; justify-content:space-between;"><span>SUBTOTAL:</span><span>â‚¹${sub}</span></div>
                <div style="display:flex; justify-content:space-between;"><span>GST (18%):</span><span>â‚¹${tax.toFixed(0)}</span></div>
                <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.2rem; margin-top:10px;">
                    <span>TOTAL:</span><span>â‚¹${total}</span>
                </div>
            </div>
            <div style="text-align:center; margin-top:30px;">
                <small>Thank you for shopping!</small><br>
                <button class="no-print action-btn" onclick="window.print()" style="margin-top:20px; background:#000;">Print Receipt</button>
                <button class="no-print action-btn" onclick="closeInvoice()" style="margin-top:10px; background:#666;">Close</button>
            </div>
        `;
        document.getElementById('invoiceModal').style.display = 'flex';
    }

    function closeInvoice() { document.getElementById('invoiceModal').style.display = 'none'; }
</script>
</body>
</html>
