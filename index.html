<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metocart | Hybrid Solutions Pvt Ltd</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --dark-bg: #0f172a; --card-bg: #1e293b; --text-main: #f8fafc; --accent: #10b981; --profit: #22c55e; --warning: #f59e0b; --danger: #ef4444; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--dark-bg); color: var(--text-main); }
        .sidebar { width: 260px; background: #020617; position: fixed; height: 100%; padding: 24px; border-right: 1px solid #1e293b; z-index: 100; }
        .nav-btn { width: 100%; padding: 14px; margin: 8px 0; background: transparent; color: #94a3b8; border: none; border-radius: 12px; text-align: left; cursor: pointer; transition: 0.2s; font-weight: 600; }
        .nav-btn.active { background: var(--primary); color: white; }
        .main-content { margin-left: 280px; padding: 40px; }
        
        /* Dashboard Grid System */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card-bg); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; }
        .kpi-card small { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .kpi-card h2 { margin: 10px 0 0 0; font-size: 1.5rem; }
        
        .dash-row { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid #334155; margin-bottom: 20px; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .quick-btn { background: #0f172a; border: 1px solid #334155; color: white; padding: 15px; border-radius: 12px; cursor: pointer; text-align: center; font-size: 0.85rem; transition: 0.3s; }
        .quick-btn:hover { border-color: var(--primary); background: #1e293b; }
        
        .status-tag { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; float: right; }
        .tag-ok { background: rgba(34, 197, 94, 0.2); color: var(--profit); }
        .tag-low { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        .section { display: none; }
        .active-section { display: block; }
        
        @media (max-width: 1024px) { .kpi-grid { grid-template-columns: 1fr 1fr; } .dash-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color:var(--primary)">Meto OS</h2>
    <p style="color:#64748b; font-size: 0.6em; margin-bottom: 20px;">Hybrid Solutions Pvt Ltd</p>
    <button class="nav-btn active" onclick="showTab('home')">üè† <span>Dashboard</span></button>
    <button class="nav-btn" onclick="showTab('billing')">üßæ <span>Quick Bill</span></button>
    <button class="nav-btn" onclick="showTab('inventory')">üì¶ <span>Inventory</span></button>
    <button class="nav-btn" onclick="showTab('ai')">ü§ñ <span>AI Insights</span></button>
</div>

<div class="main-content">
    <div id="home" class="section active-section">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 25px;">
            <h1>Store Intelligence</h1>
            <button class="quick-btn" style="padding: 8px 15px;" onclick="location.reload()">üîÑ Refresh Data</button>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <small>Total Revenue</small>
                <h2 id="rev" style="color:var(--primary)">‚Çπ0</h2>
            </div>
            <div class="kpi-card">
                <small>Net Profit</small>
                <h2 id="profit" style="color:var(--profit)">‚Çπ0</h2>
            </div>
            <div class="kpi-card">
                <small>GST Collected</small>
                <h2 id="gstTotal" style="color:var(--warning)">‚Çπ0</h2>
            </div>
            <div class="kpi-card">
                <small>Avg. Bill Value</small>
                <h2 id="avgOrder">‚Çπ0</h2>
            </div>
        </div>

        <div class="dash-row">
            <div class="card">
                <h3>üèÜ Best Sellers (Top 10)</h3>
                <div id="topItemsList" style="margin-top:20px;"></div>
            </div>

            <div class="card">
                <h3>‚ö° Quick Actions</h3>
                <div class="action-grid">
                    <button class="quick-btn" onclick="showTab('billing')">‚ûï New Sale</button>
                    <button class="quick-btn" onclick="showTab('inventory')">üì¶ Add Stock</button>
                    <button class="quick-btn" onclick="showTab('ai')">ü§ñ Ask AI</button>
                    <button class="quick-btn" onclick="exportData()">üíæ Backup</button>
                </div>
                
                <h3 style="margin-top:30px;">üìâ Critical Stock</h3>
                <div id="lowStockList" style="font-size: 0.85rem;"></div>
            </div>
        </div>
    </div>

    <div id="billing" class="section">
        <div class="card"><h2>Create Bill</h2></div>
    </div>
    <div id="inventory" class="section">
        <div class="card"><h2>Inventory Control</h2></div>
    </div>
    <div id="ai" class="section">
        <div class="card"><h2>AI Advisor</h2></div>
    </div>
</div>

<script>
    let products = JSON.parse(localStorage.getItem('hy_products')) || [];
    let sales = JSON.parse(localStorage.getItem('hy_sales')) || [];

    window.onload = () => { updateDashboard(); };

    function updateDashboard() {
        // 1. Calculate Financials
        let totalRev = 0;
        let totalProfit = 0;
        let totalGst = 0;
        
        sales.forEach(s => {
            totalRev += s.total;
            totalProfit += s.profit;
            totalGst += (s.gst || 0);
        });

        document.getElementById('rev').innerText = "‚Çπ" + totalRev.toFixed(0);
        document.getElementById('profit').innerText = "‚Çπ" + totalProfit.toFixed(0);
        document.getElementById('gstTotal').innerText = "‚Çπ" + totalGst.toFixed(0);
        
        // 2. Average Order Value
        let avg = sales.length > 0 ? (totalRev / sales.length) : 0;
        document.getElementById('avgOrder').innerText = "‚Çπ" + avg.toFixed(0);

        // 3. Top 10 Product Chart
        renderTop10();

        // 4. Low Stock Alerts
        renderLowStock();
    }

    function renderTop10() {
        const pMap = {};
        sales.forEach(sale => {
            sale.items.forEach(i => { pMap[i.name] = (pMap[i.name] || 0) + i.subtotal; });
        });
        const sorted = Object.entries(pMap).sort((a,b) => b[1] - a[1]).slice(0, 10);
        const max = sorted.length > 0 ? sorted[0][1] : 1;
        
        document.getElementById('topItemsList').innerHTML = sorted.map(([name, val]) => `
            <div style="margin-bottom:15px;">
                <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:5px;">
                    <span>${name}</span><span>‚Çπ${val.toFixed(0)}</span>
                </div>
                <div style="background:#0f172a; height:6px; border-radius:10px; width:100%;">
                    <div style="background:var(--primary); height:100%; width:${(val/max)*100}%; border-radius:10px;"></div>
                </div>
            </div>
        `).join('') || "No sales recorded.";
    }

    function renderLowStock() {
        const low = products.filter(p => p.qty < 5);
        document.getElementById('lowStockList').innerHTML = low.map(p => `
            <div style="padding:10px 0; border-bottom:1px solid #1e293b;">
                <span class="status-tag tag-low">${p.qty} LEFT</span>
                ${p.name}
            </div>
        `).join('') || "‚úÖ All stock healthy.";
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-section');
        if(id === 'home') updateDashboard();
    }

    function exportData() {
        const blob = new Blob([JSON.stringify({products, sales})], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'hybrid_solutions_backup.json';
        a.click();
    }
</script>
</body>
</html>
