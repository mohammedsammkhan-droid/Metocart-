<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metocart AI | Merchant OS</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --dark-bg: #0f172a; --card-bg: #1e293b; --text-main: #f8fafc; --accent: #10b981; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--dark-bg); color: var(--text-main); }
        
        #loginScreen { height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at top right, #1b1b4b, #0f172a); }
        .login-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); padding: 40px; border-radius: 24px; width: 320px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        
        .sidebar { width: 260px; background: #020617; position: fixed; height: 100%; padding: 24px; border-right: 1px solid #1e293b; }
        .nav-btn { width: 100%; padding: 14px; margin: 8px 0; background: transparent; color: #94a3b8; border: none; border-radius: 12px; text-align: left; cursor: pointer; transition: 0.2s; font-weight: 600; }
        .nav-btn.active { background: var(--primary); color: white; }
        
        .main-content { margin-left: 280px; padding: 40px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card-bg); padding: 24px; border-radius: 20px; border: 1px solid #334155; }
        
        .card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid #334155; margin-bottom: 20px; }
        input, select { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; color: white; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button.action-btn { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; width: 100%; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #94a3b8; padding: 12px; border-bottom: 1px solid #334155; }
        td { padding: 12px; border-bottom: 1px solid #1e293b; }
        .section { display: none; }
        .active-section { display: block; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-card">
        <h1 style="color:var(--primary)">Metocart <span style="color:white">AI</span></h1>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button class="action-btn" onclick="login()">Sign In</button>
    </div>
</div>

<div class="dashboard-container" id="dashboard" style="display:none">
    <div class="sidebar">
        <h2 style="color:var(--primary); margin-bottom: 30px;">Metocart</h2>
        <button class="nav-btn active" onclick="showTab('home')">üè† Dashboard</button>
        <button class="nav-btn" onclick="showTab('inventory')">üì¶ Smart Inventory</button>
        <button class="nav-btn" onclick="showTab('customers')">üë• Customers</button>
        <button class="nav-btn" onclick="showTab('billing')">üßæ GST Billing</button>
        <button class="nav-btn" onclick="showTab('ai')">ü§ñ AI Advisor</button>
        <button class="nav-btn" style="margin-top: 50px; color:#ef4444" onclick="location.reload()">üîí Logout</button>
    </div>

    <div class="main-content">
        <div id="home" class="section active-section">
            <h1>Business Overview</h1>
            <div class="kpi-grid">
                <div class="kpi-card"><p>Revenue</p><h2 id="rev">‚Çπ0</h2></div>
                <div class="kpi-card"><p>Profit</p><h2 id="profit">‚Çπ0</h2></div>
                <div class="kpi-card"><p>GST</p><h2 id="gstTotal">‚Çπ0</h2></div>
                <div class="kpi-card"><p>Stock Value</p><h2 id="invValue">‚Çπ0</h2></div>
            </div>
        </div>

        <div id="inventory" class="section">
            <div class="card">
                <h2>Product Catalog</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input id="pname" placeholder="Item Name">
                    <input id="pcategory" placeholder="HSN Code">
                    <input type="number" id="pcost" placeholder="Cost Price">
                    <input type="number" id="psell" placeholder="Selling Price">
                    <input type="number" id="pqty" placeholder="Stock Qty">
                </div>
                <button class="action-btn" style="margin-top:15px;" onclick="addProduct()">Add Product</button>
                <table id="productTable">
                    <thead><tr><th>Product</th><th>HSN</th><th>Stock</th></tr></thead>
                    <tbody id="inventoryBody"></tbody>
                </table>
            </div>
        </div>

        <div id="customers" class="section">
            <div class="card">
                <h2>Customer Directory</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input id="cname" placeholder="Customer Name">
                    <input id="cphone" placeholder="Phone Number">
                </div>
                <button class="action-btn" style="margin-top:15px;" onclick="addCustomer()">Register Customer</button>
                <table>
                    <thead><tr><th>Name</th><th>Phone</th></tr></thead>
                    <tbody id="customerBody"></tbody>
                </table>
            </div>
        </div>

        <div id="billing" class="section">
            <div class="card">
                <h2>Quick GST Billing</h2>
                <select id="billCustomer"><option>Select Customer</option></select>
                <select id="billProduct"><option>Select Product</option></select>
                <input type="number" id="billQty" placeholder="Quantity">
                <button class="action-btn" onclick="createInvoice()">Generate & Save Bill</button>
                <div id="invoiceOutput" style="margin-top:20px;"></div>
            </div>
        </div>

        <div id="ai" class="section">
            <div class="card">
                <h2>AI Growth Advisor</h2>
                <p style="color:#94a3b8">Ask anything about your store performance.</p>
                <input id="aiQuestion" placeholder="Example: How can I increase my profit this month?">
                <button class="action-btn" style="width:150px; margin-top:10px;" onclick="generateAI()">Ask AI</button>
                <div id="aiOutput" style="margin-top:20px; padding:15px; background:#0f172a; border-radius:10px; line-height: 1.6;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let products = [];
    let customers = [];
    let totals = { rev: 0, profit: 0, gst: 0 };
    
    // YOUR API KEY INTEGRATED HERE
    const GROQ_API_KEY = "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";

    function login() {
        if(document.getElementById('username').value === "admin" && document.getElementById('password').value === "1234") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
        } else { alert("Invalid Credentials"); }
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-section');
        event.currentTarget.classList.add('active');
    }

    function addProduct() {
        const p = { name: pname.value, hsn: pcategory.value, cost: parseFloat(pcost.value), sell: parseFloat(psell.value), qty: parseInt(pqty.value) };
        products.push(p);
        renderInventory();
        updateLists();
        updateStats();
    }

    function addCustomer() {
        customers.push({ name: cname.value, phone: cphone.value });
        renderCustomers();
        updateLists();
    }

    function renderInventory() {
        inventoryBody.innerHTML = products.map(p => `<tr><td>${p.name}</td><td>${p.hsn}</td><td>${p.qty}</td></tr>`).join('');
    }

    function renderCustomers() {
        customerBody.innerHTML = customers.map(c => `<tr><td>${c.name}</td><td>${c.phone}</td></tr>`).join('');
    }

    function updateLists() {
        billProduct.innerHTML = products.map((p, i) => `<option value="${i}">${p.name} (Stock: ${p.qty})</option>`).join('');
        billCustomer.innerHTML = customers.map((c, i) => `<option value="${i}">${c.name}</option>`).join('');
    }

    function createInvoice() {
        const p = products[billProduct.value];
        const q = parseInt(billQty.value);
        if(!p || q > p.qty) return alert("Check stock quantity");
        
        const sub = p.sell * q;
        const gst = sub * 0.18;
        p.qty -= q;
        totals.rev += (sub + gst);
        totals.gst += gst;
        totals.profit += (p.sell - p.cost) * q;
        
        updateStats();
        renderInventory();
        invoiceOutput.innerHTML = `<div style="padding:15px; border:1px solid var(--accent); border-radius:12px;"><b>Bill Generated</b><br>Amount: ‚Çπ${(sub+gst).toFixed(2)} (Incl. 18% GST)</div>`;
    }

    function updateStats() {
        rev.innerText = "‚Çπ" + totals.rev.toFixed(0);
        profit.innerText = "‚Çπ" + totals.profit.toFixed(0);
        gstTotal.innerText = "‚Çπ" + totals.gst.toFixed(0);
        invValue.innerText = "‚Çπ" + products.reduce((acc, p) => acc + (p.cost * p.qty), 0).toFixed(0);
    }

    // REAL AI INTEGRATION WITH GROQ
    async function generateAI() {
        const aiOutput = document.getElementById('aiOutput');
        const question = document.getElementById('aiQuestion').value;

        if (!question) {
            alert("Please enter a question for the advisor.");
            return;
        }

        aiOutput.innerHTML = "‚ú® Metocart AI is analyzing your store data...";

        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${GROQ_API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [
                        {
                            role: "system", 
                            content: "You are the Metocart AI Business Advisor. Provide professional, concise retail advice for the Indian market. Use the provided business data to be specific."
                        },
                        {
                            role: "user", 
                            content: `Store Data: Revenue ‚Çπ${totals.rev}, Profit ‚Çπ${totals.profit}, GST Collected ‚Çπ${totals.gst}, Customer Count: ${customers.length}, Inventory List: ${JSON.stringify(products)}. Question: ${question}`
                        }
                    ]
                })
            });

            const data = await response.json();
            const advice = data.choices[0].message.content;
            
            // Render the response and handle new lines
            aiOutput.innerHTML = `<b>Metocart Insight:</b><br>${advice.replace(/\n/g, "<br>")}`;

        } catch (error) {
            console.error("AI Error:", error);
            aiOutput.innerHTML = "<span style='color:#ef4444'>‚ö†Ô∏è Connection error. Please check your internet or API key.</span>";
        }
    }
</script>
</body>
</html>
