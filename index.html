<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metocart | Hybrid Solutions Pvt Ltd</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --dark-bg: #0f172a; --card-bg: #1e293b; --text-main: #f8fafc; --accent: #10b981; --profit: #22c55e; --danger: #ef4444; }
        body { margin: 0; font-family: 'Plus Jakarta Sans', sans-serif; background: var(--dark-bg); color: var(--text-main); }
        
        /* Login Screen */
        #loginScreen { height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at top right, #1b1b4b, #0f172a); position: fixed; width: 100%; z-index: 1000; }
        .login-card { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); padding: 40px; border-radius: 24px; width: 320px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        
        /* Layout */
        .sidebar { width: 260px; background: #020617; position: fixed; height: 100%; padding: 24px; border-right: 1px solid #1e293b; z-index: 100; }
        .nav-btn { width: 100%; padding: 14px; margin: 8px 0; background: transparent; color: #94a3b8; border: none; border-radius: 12px; text-align: left; cursor: pointer; font-weight: 600; }
        .nav-btn.active { background: var(--primary); color: white; }
        .main-content { margin-left: 280px; padding: 40px; display: none; }
        
        /* Components */
        .card { background: var(--card-bg); padding: 25px; border-radius: 20px; border: 1px solid #334155; margin-bottom: 20px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px; }
        input, select { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 12px; color: white; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        button.action-btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 700; width: 100%; }
        
        .section { display: none; }
        .active-section { display: block; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #94a3b8; padding: 10px; border-bottom: 1px solid #334155; }
        td { padding: 10px; border-bottom: 1px solid #1e293b; }

        @media (max-width: 768px) {
            .sidebar { width: 70px; padding: 10px; }
            .sidebar h2, .sidebar p, .nav-btn span { display: none; }
            .main-content { margin-left: 80px; padding: 20px; }
        }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-card">
        <h2 style="color:var(--primary)">Metocart Login</h2>
        <input type="text" id="userIn" placeholder="Username (admin)">
        <input type="password" id="passIn" placeholder="Password (1234)">
        <button class="action-btn" onclick="checkLogin()">Enter System</button>
    </div>
</div>

<div class="sidebar" id="appSidebar" style="display:none">
    <h2 style="color:var(--primary)">Meto OS</h2>
    <p style="color:#64748b; font-size: 0.6em; margin-bottom: 20px;">Hybrid Solutions</p>
    <button class="nav-btn active" onclick="showTab('home')">üè† <span>Dashboard</span></button>
    <button class="nav-btn" onclick="showTab('billing')">üßæ <span>Quick Bill</span></button>
    <button class="nav-btn" onclick="showTab('inventory')">üì¶ <span>Inventory</span></button>
    <button class="nav-btn" onclick="showTab('ai')">ü§ñ <span>AI Advisor</span></button>
    <button class="nav-btn" onclick="location.reload()" style="margin-top:50px; color:var(--danger)">Logout</button>
</div>

<div class="main-content" id="appMain">
    
    <div id="home" class="section active-section">
        <h1>Dashboard</h1>
        <div class="kpi-grid">
            <div class="card"><small>Revenue</small><h2 id="rev" style="color:var(--primary)">‚Çπ0</h2></div>
            <div class="card"><small>Net Profit</small><h2 id="profit" style="color:var(--profit)">‚Çπ0</h2></div>
            <div class="card"><small>Total Sales</small><h2 id="salesCount">0</h2></div>
        </div>
        <div class="card">
            <h3>üèÜ Top 10 Bestsellers</h3>
            <div id="topItemsList"></div>
        </div>
    </div>

    <div id="billing" class="section">
        <div class="card">
            <h2>New Invoice</h2>
            <input id="billCustName" placeholder="Customer Name">
            <div style="display:grid; grid-template-columns: 2fr 1fr 80px; gap:10px;">
                <select id="billProduct"><option value="">Select Product</option></select>
                <input type="number" id="billQty" value="1">
                <button class="action-btn" onclick="addToCart()" style="background:var(--accent)">Add</button>
            </div>
            <div id="cartDisplay" style="margin-top:20px; border-top:1px solid #334155; padding-top:10px;">
                <div id="cartItemsList"></div>
                <div id="cartSummary" style="display:none; text-align:right;">
                    <h3 id="cartTotalText">Total: ‚Çπ0</h3>
                    <button class="action-btn" onclick="processSale()" style="width:200px">Finish & Print</button>
                </div>
            </div>
        </div>
    </div>

    <div id="inventory" class="section">
        <div class="card">
            <h2>Add New Stock</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input id="pname" placeholder="Item Name">
                <input type="number" id="pcost" placeholder="Cost Price">
                <input type="number" id="psell" placeholder="Sale Price">
                <input type="number" id="pqty" placeholder="Quantity">
            </div>
            <button class="action-btn" onclick="addProduct()">Save to Inventory</button>
        </div>
        <div class="card">
            <h3>Current Stock</h3>
            <table>
                <thead><tr><th>Item</th><th>Price</th><th>Stock</th><th>Action</th></tr></thead>
                <tbody id="inventoryBody"></tbody>
            </table>
        </div>
    </div>

    <div id="ai" class="section">
        <div class="card">
            <h2>AI Business Insights</h2>
            <textarea id="aiQuestion" style="width:100%; height:80px; background:#0f172a; color:white; border-radius:8px; padding:10px;" placeholder="How can I grow my sales?"></textarea>
            <button class="action-btn" style="margin-top:10px" onclick="askAI()">Analyze My Business</button>
            <div id="aiOutput" style="margin-top:20px; color:var(--primary); line-height:1.6;"></div>
        </div>
    </div>
</div>

<script>
    // DATA CORE
    let products = JSON.parse(localStorage.getItem('hy_products')) || [];
    let sales = JSON.parse(localStorage.getItem('hy_sales')) || [];
    let currentCart = [];
    const API_KEY = "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";

    // 1. LOGIN SYSTEM
    function checkLogin() {
        const u = document.getElementById('userIn').value;
        const p = document.getElementById('passIn').value;
        if(u === "admin" && p === "1234") {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appSidebar').style.display = 'block';
            document.getElementById('appMain').style.display = 'block';
            updateDashboard();
            renderInventory();
            updateProductDropdown();
        } else { alert("Invalid Credentials!"); }
    }

    // 2. NAVIGATION
    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active-section');
        event.currentTarget.classList.add('active');
        if(id === 'home') updateDashboard();
    }

    // 3. INVENTORY SERVICE
    function addProduct() {
        const p = { 
            name: pname.value, 
            cost: parseFloat(pcost.value) || 0, 
            sell: parseFloat(psell.value) || 0, 
            qty: parseInt(pqty.value) || 0 
        };
        if(!p.name) return alert("Enter item name");
        products.push(p);
        saveData();
        renderInventory();
        updateProductDropdown();
        pname.value = ''; pcost.value = ''; psell.value = ''; pqty.value = '';
    }

    function renderInventory() {
        inventoryBody.innerHTML = products.map((p, i) => `
            <tr>
                <td>${p.name}</td>
                <td>‚Çπ${p.sell}</td>
                <td style="color:${p.qty < 5 ? 'var(--danger)' : 'white'}">${p.qty}</td>
                <td><button onclick="deleteProduct(${i})" style="color:var(--danger); background:none; border:none; cursor:pointer;">Del</button></td>
            </tr>
        `).join('');
    }

    function deleteProduct(i) {
        products.splice(i, 1);
        saveData(); renderInventory(); updateProductDropdown();
    }

    // 4. BILLING SERVICE
    function updateProductDropdown() {
        billProduct.innerHTML = '<option value="">Select Product</option>' + 
            products.map((p, i) => `<option value="${i}">${p.name} (‚Çπ${p.sell})</option>`).join('');
    }

    function addToCart() {
        const idx = billProduct.value;
        if(idx === "") return;
        const p = products[idx];
        const qty = parseInt(billQty.value);
        if(qty > p.qty) return alert("Stock low!");
        
        currentCart.push({ name: p.name, qty: qty, price: p.sell, cost: p.cost, subtotal: p.sell * qty, id: idx });
        renderCart();
    }

    function renderCart() {
        let total = 0;
        cartItemsList.innerHTML = currentCart.map((c, i) => {
            total += c.subtotal;
            return `<div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>${c.name} x${c.qty}</span><span>‚Çπ${c.subtotal}</span>
            </div>`;
        }).join('');
        document.getElementById('cartSummary').style.display = currentCart.length > 0 ? 'block' : 'none';
        document.getElementById('cartTotalText').innerText = "Total: ‚Çπ" + (total * 1.18).toFixed(0);
    }

    function processSale() {
        let totalRev = 0; let totalProfit = 0;
        currentCart.forEach(item => {
            products[item.id].qty -= item.qty;
            totalRev += (item.subtotal * 1.18);
            totalProfit += (item.price - item.cost) * item.qty;
        });

        sales.push({ timestamp: new Date(), items: [...currentCart], total: totalRev, profit: totalProfit });
        saveData();
        currentCart = [];
        renderCart();
        renderInventory();
        updateProductDropdown();
        alert("Invoice Saved & Printed!");
    }

    // 5. DASHBOARD & AI
    function updateDashboard() {
        const rev = sales.reduce((a, b) => a + b.total, 0);
        const prof = sales.reduce((a, b) => a + b.profit, 0);
        document.getElementById('rev').innerText = "‚Çπ" + rev.toFixed(0);
        document.getElementById('profit').innerText = "‚Çπ" + prof.toFixed(0);
        document.getElementById('salesCount').innerText = sales.length;
        
        // Simple Top Item Logic
        const counts = {};
        sales.forEach(s => s.items.forEach(i => counts[i.name] = (counts[i.name] || 0) + i.subtotal));
        const sorted = Object.entries(counts).sort((a,b) => b[1]-a[1]).slice(0,5);
        topItemsList.innerHTML = sorted.map(s => `<div>${s[0]} - ‚Çπ${s[1].toFixed(0)}</div>`).join('') || "No sales yet.";
    }

    async function askAI() {
        aiOutput.innerText = "‚ú® AI is thinking...";
        try {
            const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "llama-3.3-70b-versatile",
                    messages: [{ role: "user", content: `Business context: Revenue ‚Çπ${rev.innerText}, Sales ${sales.length}. Question: ${aiQuestion.value}` }]
                })
            });
            const data = await response.json();
            aiOutput.innerText = data.choices[0].message.content;
        } catch(e) { aiOutput.innerText = "Error connecting to AI."; }
    }

    function saveData() {
        localStorage.setItem('hy_products', JSON.stringify(products));
        localStorage.setItem('hy_sales', JSON.stringify(sales));
    }
</script>
</body>
</html>
